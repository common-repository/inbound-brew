!function($){$.fn.ib_leadSettings=function(method){var _dataTable,_ibThis,_form,_editing,_actionField,defaults={data:"",default_field_action:"ib_add_custom_lead_field",edit_field_action:"ib_edit_custom_lead_field",delete_field_action:"ib_delete_custom_lead_field",add_new_title:"Add Custom Field",edit_field_title:"Edit Custom Field"},methods={init:function(options){var $table=_ibThis.find("#custom-list");_dataTable=$table.dataTable({bFilter:!1,bInfo:!1,bPaginate:!1,columnDefs:[{orderable:!1,targets:[2,3]}],pageLength:25,asStripeClasses:[]}),$("#add_new").click(function(e){e.preventDefault(),methods.addNewField()}),$(".option_div").hide(),$("#LeadFieldFieldType").change(function(e){e.preventDefault(),methods.changeType()}),_cancelButton=_ibThis.find("#cancelButton"),_cancelButton.click(function(e){e.preventDefault(),methods.addNewField()}),_ibThis.find("select").on("change",function(){methods.handleFieldType($(this),!0)}),_ibThis.on("keypress",":input:not(textarea)",function(event){13==event.keyCode&&event.preventDefault(),_changesMade||(_changesMade=!0,_cancelButton.show())}),$table.on("click","a",function(event){event.preventDefault();var $me=$(this);$me.hasClass("fa-pencil")?methods.editCustomField($me.closest("tr")):methods.deleteCustomField($me.closest("tr"))}),_form=_ibThis.find("form"),_form.validate({submitHandler:function(form){return methods.sendValues(),!1}}),_actionField=_ibThis.find('form input[name="action"]')},deleteCustomField:function($row){$.confirm({title:"Delete Custom Lead Field?",content:"Are you sure you want to delete this lead field? <strong>This will delete it from emails, contact forms and data for leads.</delete>",confirmButtonClass:"ib_delete",cancelButtonClass:"ib_cancel",confirmButton:"Delete",confirm:function(){var field_id=$row.attr("id").replace("field_",""),data={action:settings.delete_field_action,nonce:ibSettingsAjax.ibSettingsNonce,lead_field_id:field_id};$.ajax({url:ibSettingsAjax.ajaxurl,dataType:"json",type:"post",data:data,success:function(response,status){if(response.success){var nRow=$row[0];_dataTable.fnDeleteRow(nRow,null,!0);var title="Success!"}else var title="Error!";$.alert({title:title,content:response.message,confirmButtonClass:"ib_save"})},error:function(jqXhr,textStatus,errorThrown){console.log(errorThrown),_lockClick=!1}})}})},editCustomField:function($row){$counter=0;var $tds=$row.children(),field_name=$tds.eq(0).text(),field_type=$tds.eq(1).text().toLowerCase(),field_value=$tds.eq(2).text().replace(/, /g,"\n"),$type=$("#LeadFieldFieldType");$type.val(field_type),$("#LeadFieldFieldName").val(field_name),$("#LeadFieldFieldValue").val(field_value),_actionField.val(settings.edit_field_action),$("#LeadFieldLeadFieldId").val($row.attr("id").replace("field_","")),methods.handleFieldType($type,!0),_editing=$row,_mode="edit"},sendValues:function(){$.ajax({url:ibSettingsAjax.ajaxurl,dataType:"json",type:"post",data:_form.serialize()+"&nonce="+ibSettingsAjax.ibSettingsNonce,success:function(response,status){if(response.success){var data=[response.field.field_name,response.field.field_type.toUpperCase(),response.field.field_value,'<a href="#" class="ib_icon-link fa fa-pencil"></a>\t\t\t\t\t\t\t\t<a href="#" class="ib_icon-link delete fa fa-trash ib_delete-field"></a>'];if("add"==_mode){var newTr=_dataTable.fnAddData(data),oSettings=_dataTable.fnSettings(),nTr=oSettings.aoData[newTr[0]].nTr;nTr.id="field_"+response.field.field_id}else _dataTable.fnUpdate(data,_editing[0]);methods.clearFields(!1)}else $.alert({title:"Error!",content:response.message,confirmButtonClass:"ib_save"})},error:function(jqXhr,textStatus,errorThrown){console.log(errorThrown),_lockClick=!1}})},addNewField:function(){_changesMade?$.confirm({title:"Lose changes?",content:"By clicking CLEAR you will lose your changes.",confirmButton:"Clear",cancelButton:"Cancel",confirmButtonClass:"ib_save",cancelButtonClass:"ib_cancel",confirm:function(){methods.clearFields(!0)}}):methods.clearFields(!0)},clearFields:function(scroll){_changesMade=!1,_cancelButton.hide();var $type=_ibThis.find("#LeadFieldFieldType");$type.val("");var $name=_ibThis.find("#LeadFieldFieldName");$name.val(""),_ibThis.find("#LeadFieldFieldValue").val(""),$name.focus(),methods.handleFieldType($type,!1),_actionField.val(settings.default_field_action),_ibThis.find(".ib-form-title").html(settings.add_new_title),$("#LeadFieldLeadFieldId").val(""),_mode="add",scroll&&$("html, body").animate({scrollTop:_form.offset().top},2e3)},handleFieldType:function($type,$from_imput){switch($type.val()){case"select":case"radio":case"checkbox":_ibThis.find("#LeadFieldFieldValue").prop("disabled",!1),$(".option_div").show();break;default:_ibThis.find("#LeadFieldFieldValue").prop("disabled",!0),$(".option_div").hide()}$from_imput&&!_changesMade&&(_changesMade=!0,_cancelButton.show())},changeType:function($type){}},_mode="add",_changesMade=!1,settings=$.extend({},defaults,method);return methods[method]?(_ibThis=$(this),methods[method].apply(this,Array.prototype.slice.call(arguments,1))):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.ib_leadSettings"):this.each(function(){_ibThis=$(this),methods.init()})}}(jQuery);