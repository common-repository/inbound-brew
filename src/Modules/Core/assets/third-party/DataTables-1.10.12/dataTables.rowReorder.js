!function(factory){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function($){return factory($,window,document)}):"object"==typeof exports?module.exports=function(root,$){return root||(root=window),$&&$.fn.dataTable||($=require("datatables.net")(root,$).$),factory($,root,root.document)}:factory(jQuery,window,document)}(function($,window,document,undefined){"use strict";var DataTable=$.fn.dataTable,RowReorder=function(dt,opts){if(!DataTable.versionCheck||!DataTable.versionCheck("1.10.8"))throw"DataTables RowReorder requires DataTables 1.10.8 or newer";this.c=$.extend(!0,{},DataTable.defaults.rowReorder,RowReorder.defaults,opts),this.s={bodyTop:null,dt:new DataTable.Api(dt),getDataFn:DataTable.ext.oApi._fnGetObjectDataFn(this.c.dataSrc),middles:null,scroll:{},scrollInterval:null,setDataFn:DataTable.ext.oApi._fnSetObjectDataFn(this.c.dataSrc),start:{top:0,left:0,offsetTop:0,offsetLeft:0,nodes:[]},windowHeight:0,documentOuterHeight:0,domCloneOuterHeight:0},this.dom={clone:null,dtScroll:$("div.dataTables_scrollBody",this.s.dt.table().container())};var settings=this.s.dt.settings()[0],exisiting=settings.rowreorder;return exisiting?exisiting:(settings.rowreorder=this,void this._constructor())};$.extend(RowReorder.prototype,{_constructor:function(){var that=this,dt=this.s.dt,table=$(dt.table().node());"static"===table.css("position")&&table.css("position","relative"),$(dt.table().container()).on("mousedown.rowReorder touchstart.rowReorder",this.c.selector,function(e){if(that.c.enable){var tr=$(this).closest("tr"),row=dt.row(tr);return row.any()?(that._emitEvent("pre-row-reorder",{node:row.node(),index:row.index()}),that._mouseDown(e,tr),!1):void 0}}),dt.on("destroy.rowReorder",function(){$(dt.table().container()).off(".rowReorder"),dt.off(".rowReorder")})},_cachePositions:function(){var dt=this.s.dt,headerHeight=$(dt.table().node()).find("thead").outerHeight(),nodes=$.unique(dt.rows({page:"current"}).nodes().toArray()),tops=$.map(nodes,function(node,i){return $(node).position().top-headerHeight}),middles=$.map(tops,function(top,i){return tops.length<i-1?(top+tops[i+1])/2:(top+top+$(dt.row(":last-child").node()).outerHeight())/2});this.s.middles=middles,this.s.bodyTop=$(dt.table().body()).offset().top,this.s.windowHeight=$(window).height(),this.s.documentOuterHeight=$(document).outerHeight()},_clone:function(target){var dt=this.s.dt,clone=$(dt.table().node().cloneNode(!1)).addClass("dt-rowReorder-float").append("<tbody/>").append(target.clone(!1)),tableWidth=target.outerWidth(),tableHeight=target.outerHeight(),sizes=target.children().map(function(){return $(this).width()});clone.width(tableWidth).height(tableHeight).find("tr").children().each(function(i){this.style.width=sizes[i]+"px"}),clone.appendTo("body"),this.dom.clone=clone,this.s.domCloneOuterHeight=clone.outerHeight()},_clonePosition:function(e){var left,start=this.s.start,topDiff=this._eventToPage(e,"Y")-start.top,leftDiff=this._eventToPage(e,"X")-start.left,snap=this.c.snapX,top=topDiff+start.offsetTop;left=snap===!0?start.offsetLeft:"number"==typeof snap?start.offsetLeft+snap:leftDiff+start.offsetLeft,top<0?top=0:top+this.s.domCloneOuterHeight>this.s.documentOuterHeight&&(top=this.s.documentOuterHeight-this.s.domCloneOuterHeight),this.dom.clone.css({top:top,left:left})},_emitEvent:function(name,args){this.s.dt.iterator("table",function(ctx,i){$(ctx.nTable).triggerHandler(name+".dt",args)})},_eventToPage:function(e,pos){return e.type.indexOf("touch")!==-1?e.originalEvent.touches[0]["page"+pos]:e["page"+pos]},_mouseDown:function(e,target){var that=this,dt=this.s.dt,start=this.s.start,offset=target.offset();start.top=this._eventToPage(e,"Y"),start.left=this._eventToPage(e,"X"),start.offsetTop=offset.top,start.offsetLeft=offset.left,start.nodes=$.unique(dt.rows({page:"current"}).nodes().toArray()),this._cachePositions(),this._clone(target),this._clonePosition(e),this.dom.target=target,target.addClass("dt-rowReorder-moving"),$(document).on("mouseup.rowReorder touchend.rowReorder",function(e){that._mouseUp(e)}).on("mousemove.rowReorder touchmove.rowReorder",function(e){that._mouseMove(e)}),$(window).width()===$(document).width()&&$(document.body).addClass("dt-rowReorder-noOverflow");var scrollWrapper=this.dom.dtScroll;this.s.scroll={windowHeight:$(window).height(),windowWidth:$(window).width(),dtTop:scrollWrapper.length?scrollWrapper.offset().top:null,dtLeft:scrollWrapper.length?scrollWrapper.offset().left:null,dtHeight:scrollWrapper.length?scrollWrapper.outerHeight():null,dtWidth:scrollWrapper.length?scrollWrapper.outerWidth():null}},_mouseMove:function(e){this._clonePosition(e);for(var bodyY=this._eventToPage(e,"Y")-this.s.bodyTop,middles=this.s.middles,insertPoint=null,dt=this.s.dt,body=dt.table().body(),i=0,ien=middles.length;i<ien;i++)if(bodyY<middles[i]){insertPoint=i;break}if(null===insertPoint&&(insertPoint=middles.length),null===this.s.lastInsert||this.s.lastInsert!==insertPoint){if(0===insertPoint)this.dom.target.prependTo(body);else{var nodes=$.unique(dt.rows({page:"current"}).nodes().toArray());insertPoint>this.s.lastInsert?this.dom.target.insertAfter(nodes[insertPoint-1]):this.dom.target.insertBefore(nodes[insertPoint])}this._cachePositions(),this.s.lastInsert=insertPoint}this._shiftScroll(e)},_mouseUp:function(e){var i,ien,that=this,dt=this.s.dt,dataSrc=this.c.dataSrc;this.dom.clone.remove(),this.dom.clone=null,this.dom.target.removeClass("dt-rowReorder-moving"),$(document).off(".rowReorder"),$(document.body).removeClass("dt-rowReorder-noOverflow"),clearInterval(this.s.scrollInterval),this.s.scrollInterval=null;var startNodes=this.s.start.nodes,endNodes=$.unique(dt.rows({page:"current"}).nodes().toArray()),idDiff={},fullDiff=[],diffNodes=[],getDataFn=this.s.getDataFn,setDataFn=this.s.setDataFn;for(i=0,ien=startNodes.length;i<ien;i++)if(startNodes[i]!==endNodes[i]){var id=dt.row(endNodes[i]).id(),endRowData=dt.row(endNodes[i]).data(),startRowData=dt.row(startNodes[i]).data();id&&(idDiff[id]=getDataFn(startRowData)),fullDiff.push({node:endNodes[i],oldData:getDataFn(endRowData),newData:getDataFn(startRowData),newPosition:i,oldPosition:$.inArray(endNodes[i],startNodes)}),diffNodes.push(endNodes[i])}var eventArgs=[fullDiff,{dataSrc:dataSrc,nodes:diffNodes,values:idDiff,triggerRow:dt.row(this.dom.target)}];if(this._emitEvent("row-reorder",eventArgs),this.c.editor&&(this.c.enable=!1,this.c.editor.edit(diffNodes,!1,$.extend({submit:"changed"},this.c.formOptions)).multiSet(dataSrc,idDiff).one("submitComplete",function(){that.c.enable=!0}).submit()),this.c.update){for(i=0,ien=fullDiff.length;i<ien;i++){var row=dt.row(fullDiff[i].node),rowData=row.data();setDataFn(rowData,fullDiff[i].newData),dt.columns().every(function(){this.dataSrc()===dataSrc&&dt.cell(fullDiff[i].node,this.index()).invalidate("data")})}this._emitEvent("row-reordered",eventArgs),dt.draw(!1)}},_shiftScroll:function(e){var windowVert,dtVert,that=this,scroll=(this.s.dt,this.s.scroll),runInterval=!1,scrollSpeed=5,buffer=65,windowY=e.pageY-document.body.scrollTop;windowY<buffer?windowVert=scrollSpeed*-1:windowY>scroll.windowHeight-buffer&&(windowVert=scrollSpeed),null!==scroll.dtTop&&e.pageY<scroll.dtTop+buffer?dtVert=scrollSpeed*-1:null!==scroll.dtTop&&e.pageY>scroll.dtTop+scroll.dtHeight-buffer&&(dtVert=scrollSpeed),windowVert||dtVert?(scroll.windowVert=windowVert,scroll.dtVert=dtVert,runInterval=!0):this.s.scrollInterval&&(clearInterval(this.s.scrollInterval),this.s.scrollInterval=null),!this.s.scrollInterval&&runInterval&&(this.s.scrollInterval=setInterval(function(){if(scroll.windowVert&&(document.body.scrollTop+=scroll.windowVert),scroll.dtVert){var scroller=that.dom.dtScroll[0];scroll.dtVert&&(scroller.scrollTop+=scroll.dtVert)}},20))}}),RowReorder.defaults={dataSrc:0,editor:null,enable:!0,formOptions:{},selector:"td:first-child",snapX:!1,update:!0};var Api=$.fn.dataTable.Api;return Api.register("rowReorder()",function(){return this}),Api.register("rowReorder.enable()",function(toggle){return toggle===undefined&&(toggle=!0),this.iterator("table",function(ctx){ctx.rowreorder&&(ctx.rowreorder.c.enable=toggle)})}),Api.register("rowReorder.disable()",function(){return this.iterator("table",function(ctx){ctx.rowreorder&&(ctx.rowreorder.c.enable=!1)})}),RowReorder.version="1.2.0",$.fn.dataTable.RowReorder=RowReorder,$.fn.DataTable.RowReorder=RowReorder,$(document).on("init.dt.dtr",function(e,settings,json){if("dt"===e.namespace){var init=settings.oInit.rowReorder,defaults=DataTable.defaults.rowReorder;if(init||defaults){var opts=$.extend({},init,defaults);init!==!1&&new RowReorder(settings,opts)}}}),RowReorder});