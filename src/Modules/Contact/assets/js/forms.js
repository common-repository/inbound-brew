!function($){function buildForm(obj){var builder=!1,html="";"undefined"!=typeof obj&&(builder=new FormBuilder(obj),html+="<div ","undefined"!=typeof obj.field_id&&(html+='id="cf-'+obj.field_id+'" '),html+='class="ib-form" data-id="'+obj.token+'">',html+=builder.element,html+="</div>"),$('[data-role="input-wrapper"]').append(html),copyFormPreview(),updatefields(),builder&&"undefined"!=typeof obj.field_id&&addFormData(obj.field_id)}function updatefields(){$("div.tag-generator div").each(function(){$(this).removeClass("disabled"),$(".fa-minus").hide(),$(".fa-plus").show()}),$("div.ib-form").each(function(){$('.br[data-value="'+$(this).data("id")+'"]').addClass("disabled"),$('.fa-plus[data-value="'+$(this).data("id")+'"]').hide(),"name"!=$(this).data("id")&&"email"!=$(this).data("id")&&$('.fa-minus[data-value="'+$(this).data("id")+'"]').show()})}function addFormData(field_id){var elm='<input type="hidden" id="lf-'+field_id+'" name="leadfield[]" value="'+field_id+'" />';$("#input_holder").append(elm)}function detachFormData(field_id){$("#lf-"+field_id).remove()}function copyFormPreview(){$('[data-role="cf-input"]').val(""),$('[data-role="cf-input"]').val($('[data-role="form-display-wrapper"]').html().trim()).trigger("change")}function removeFormElements($elm){if($elm.remove(),updatefields(),"undefined"!=typeof $elm.attr("id")){var field_id=$elm.attr("id").replace("cf-","");"undefined"!==field_id&&detachFormData(field_id)}}function checkTokenUsage(){var tokens=new Array;$("div#ib-sortable, div.ib-form").each(function(){"undefined"!=typeof $(this).data("id")&&tokens.push($(this).data("id"))}),$("div#ib_cf_email_template, div.ib-pill").each(function(){var $el=$(this),$closest=$el.closest('div[data-role="template-info"]');if(0!=$closest.length){var radio_id=$el.closest('div[data-role="template-info"]').attr("id").replace("template-details-","template-");$("#"+radio_id).prop("disabled",!1)}tokens.indexOf($el.data("token"))!==-1?$el.addClass("ib-used"):$("#post_type").length&&"ib-landing-page"!=$("#post_type").val()&&($el.removeClass("ib-used"),$("#"+radio_id).prop("disabled",!0),$("#"+radio_id).prop("checked",!1))}),tokens=[]}function appendEmailPreviews(){$(".ib_cf_email_preview").each(function(){$(this).click(function(e){e.preventDefault();var href=$(this).attr("href"),content='<iframe width="100%" src="'+href+'" id="email-quick-preview"></iframe>';_jconfirm=$.alert({title:$(this).data("title"),content:content,confirmButton:"CLOSE",confirmButtonClass:"ib_save",columnClass:"ib-template-preview-float",icon:"fa fa-eye",onOpen:function(){$("#email-quick-preview").on("load",function(){var $me=$(this),$body=$me.contents().find("body");if($body.length){var height=parseFloat($body.outerHeight())+20;$me.attr("height",height+"px")}methods.recenterModal()})}})})})}$(document).ready(function(){function toggleNoEmail(){$noEmail.is(":checked")?$ibEmailTemplates.slideUp():$ibEmailTemplates.slideDown()}function toggleThankYouStatus(type){switch(type){case"redirect":$("#thank_you_redirect").prop("disabled",!1),$("#thank_you_message").prop("disabled",!0);break;case"message":$("#thank_you_redirect").prop("disabled",!0),$("#thank_you_message").prop("disabled",!1)}}updatefields(),$("#ib-sortable").sortable(),$(".ib-draggable").draggable({addClasses:!0}),$("#contact-form-dialog").dialog({minHeigt:400,minWidth:600,autoOpen:!1}),$("#shortcode-help").dialog({autoOpen:!1}),checkTokenUsage(),appendEmailPreviews();var $noEmail=$("#ib_dont_send_email"),$ibEmailTemplates=$("#ib_email_templates");toggleNoEmail(),$noEmail.click(function(){toggleNoEmail()});var $allowDownload=$("#allow-download");$allowDownload.length>0&&($allowDownload.click(function(){var $me=$(this);$me.is(":checked")?$("#ib_download_settings").slideDown():$("#ib_download_settings").slideUp()}),$allowDownload.is(":checked")?$("#ib_download_settings").slideDown():$("#ib_download_settings").slideUp());var $thankYouOptionRedirect=$("#ib_thank_you_option_redirect");$thankYouOptionRedirect.click(function(){toggleThankYouStatus("redirect")}),$thankYouOptionRedirect.is(":checked")&&toggleThankYouStatus("redirect");var $thankYouOptionMessage=$("#ib_thank_you_option_message");$thankYouOptionMessage.click(function(){toggleThankYouStatus("message")}),$thankYouOptionMessage.is(":checked")&&toggleThankYouStatus("message");var file_frame;$("#upload_download_content").click(function(e){e.preventDefault(),file_frame&&file_frame.open(),file_frame=wp.media.frames.file_frame=wp.media({title:"Select Downloadable Content",button:{text:"Add"},multiple:!1}),file_frame.on("select",function(){attachment=file_frame.state().get("selection").first().toJSON();var imgurl=attachment.url;$("#download_content").val(imgurl)}),file_frame.open()}),$("#ib-contact-form").on("click keyup",function(e){var $elm=$(e.target);if("add-field"===$elm.data("role")&&!$elm.hasClass("disabled")){var obj=($elm.data("value"),{}),name=$elm.data("name");$.confirm({theme:"hololight",title:"Add form Field: "+name,content:function($obj){return $.ajax({method:"POST",data:{context:$elm.data("context"),token:$elm.data("value"),name:name,action:"load_lead_field_options"},url:ibAjax.ajaxurl,dataType:"html",success:function(data){$obj.setContent(data)},error:function(jqXhr,textStatus,errorThrown){$obj.contentDiv.html("Something went wrong, please try again later.")}})},confirm:function(){this.$b.find(":input").each(function(){$(this).is(":checked")?obj[$(this).attr("name")]="true":obj[$(this).attr("name")]=$(this).val()});var val=this.$b.find('input[name="label"]').val();return""!=val&&void buildForm(obj)},confirmButtonClass:"ib_save",cancelButtonClass:"ib_cancel"})}if("button-text"==$elm.data("role")){var val=$elm.val();$("input[data-type='submit']").val(val),copyFormPreview()}if("add-lead-field"==$elm.data("role")&&$("#contact-form-dialog").dialog("open"),"short-code"==$elm.data("type")&&$("#shortcode-help").dialog("open"),"remove-field"==$elm.data("role")){var $target=$('div[data-id="'+$elm.data("target")+'"]');removeFormElements($target),copyFormPreview()}}),$("#ib_contact_form").validate({rules:{post_title:"required",download_content:{required:function(element){return $("#allow-download").is(":checked")}},thank_you_message:{required:function(element){return $("#ib_thank_you_option_message").is(":checked")}},thank_you_redirect:{required:function(element){return $("#ib_thank_you_option_redirect").is(":checked")}},dont_send_email_template:{require_from_group:[1,".email_template_group"]},"email_template[]":{require_from_group:[1,".email_template_group"]}},messages:{dont_send_email_template:'Either select "Don\'t Send an Email" or pick an email (or emails) to send',"email_template[]":""},errorPlacement:function(error,element){"dont_send_email_template"==element.attr("name")||"email_template[]"==element.attr("name")?error.insertAfter("#ib_dont_send_email_header"):error.insertAfter(element)},submitHandler:function(form){console.log("form",form),$("#submit_form").css("opactity",".5").prop("disabled",!0),""==$("#form_content").val()&&buildForm(),form.submit()}}),$('[data-role="form-type"]').on("change",function(){$.ajax({method:"POST",url:ibAjax.ajaxurl,data:{context:$('[data-role="form-type"]').val(),action:"load_custom_lead_field"},dataType:"html",success:function(data){$('[data-role="field-options-holder"]').html(data)},error:function(){$obj.contentDiv.html("Something went wrong, please try again later.")}})}),$("#contact-form-dialog").on("click",".ib-button",function(){$.ajax({url:ibAjax.ajaxurl,dataType:"json",type:"post",data:$("#custom-field-add").serialize(),success:function(data){var $content=$('.ib-row[data-role="field-holder"]:last').clone();$content.find('[data-role="add-field"]').hasClass("grey")?$content.find('[data-role="add-field"]').removeClass("grey"):$content.find('[data-role="add-field"]').addClass("grey"),$content.find('[data-role="add-field"]').attr("id",data.field_id),$content.hasClass("disabled")&&$content.removeClass("disabled"),$content.find('[data-role="add-field"]').attr("data-context",data.context),$content.find('[data-role="add-field"]').attr("data-value",data.token),$content.find('[data-role="add-field"]').attr("data-name",data.name),$content.find('[data-role="remove-field"]').attr("data-value",data.token),$content.find('[data-role="remove-field"]').attr("data-target",data.token),$content.find('.br[data-role="add-field"]').html(data.name),$('[data-role="custom-field-wrapper"]').append($content),$("#contact-form-dialog").dialog("close")},error:function(data,textStatus,errorThrown){$("#add-error").text(data.responseJSON.message),$("#add-error").show()}})}),$("#contact-form-dialog").on("click","input",function(){$("#add-error").text(""),$("#add-error").hide()}),$('[data-role="form-display-wrapper"]').on("mouseup",function(){setTimeout(function(){copyFormPreview()},600)}),$('.ib-form [data-type="submit"]').on("click",function(e){e.preventDefault()}),$('.ib-form [data-type="submit"]').each(function(){$(this).attr("name","btnSubmit"),$(this).attr("type","submit")}),$(document).on({mouseenter:function(){"submit"!=$(this).find("input").data("type")&&"name"!=$(this).find("input").data("type")&&"email"!=$(this).find("input").data("type")&&($(this).addClass("ib-draggable"),$('<i data-role="remove-field" class="fa fa-minus ib-orange" data-target="'+$(this).data("id")+'"></span>').appendTo($(this)))},mouseleave:function(){$(this).find('i[data-role="remove-field"].fa-minus').remove(),$(this).removeClass("ib-draggable"),$(this).removeAttr("style")}},'[data-role="form-display-wrapper"] div.ib-form'),$("#form_content").change(function(){checkTokenUsage()}),$(".ib-link").on("click",function(e){var id=$(this).data("role");$("#template-details-"+id).toggle("slow",function(){})})})}(jQuery);