!function($){$.fn.ib_ctaEditor=function(method){var _ibThis,_ctaPreviewButton,_htmlPreview,_previewHolder,_mediaWindow,_hoverStyleTag,_hoverStyles,_hoverStylesList,_hoverIconStylesList,defaults={data:""},methods={init:function(options){_previewHolder=_ibThis.find("#cta_preview"),_ctaPreviewButton=_previewHolder.find("a"),_htmlPreview=_ibThis.find("#html_preview"),$("#cta_settings").ib_ctaTabs(),_ibThis.find(".ib_font-awesome-picker").ib_fontAwesomePicker(),_ibThis.find("div.ib_slider-value > input").each(function(){$(this).on("change",function(){methods.updateTextLinkedSliderScrubber($(this))})}),_ibThis.find(".ui-slider").each(function(){$(this).slider({min:$(this).data("min")||0,max:$(this).data("max")||100,value:$(this).data("value")||0,change:function(event,slider){var $slider=$(this);methods.updateSliderLinkedTextfield($slider)}})});var $colorPickers=$(".ib_color-picker");$colorPickers.each(function(){var $me=$(this);$me.after('<span class="ib_color-pick">&nbsp;</span>');var prevColor=$me.val(),$colorPreview=$me.next(".ib_color-pick");prevColor.length&&$colorPreview.css("background-color","#"+prevColor),$colorPreview.click(function(){$(this).prev(".ib_color-picker").trigger("click")}),$me.colpick({layout:"hex",submit:0,colorScheme:"light",onChange:function(hsb,hex,rgb,el,bySetColor){var $el=$(el);$el.next(".ib_color-pick").css("background-color","#"+hex),hex!=$el.val()&&($el.val(hex),$el.trigger("change"))}}),$me.on("change",function(){$me.colpickSetColor($me.val(),!0)})}),$(".ib_radius-editor").ib_radiusEditor(),$(".hover-state .hover-options input").each(function(){var $me=$(this);$me.click(function(){methods.toggleHoverState($(this))}),methods.toggleHoverState($me)}),$("#CallToActionNormalBackgroundType0,#CallToActionNormalBackgroundType1,#CallToActionHoverBackgroundType0,#CallToActionHoverBackgroundType1").each(function(){var $me=$(this);$me.click(function(){methods.toggleBackgroundType($(this))}),$me.is(":checked")&&methods.toggleBackgroundType($me)}),$ibTransforms=$(".ib_cta-transform"),$ibTransforms.each(function(){$(this).click(function(){methods.toggleTextTransforn($(this))})}),$("#CallToActionActionsCtaLink0,#CallToActionActionsCtaLink1").each(function(){var $me=$(this);$me.click(function(){methods.toggleLinkType($(this))}),$me.is(":checked")&&methods.toggleLinkType($me)}),_ibThis.find('input[type="hidden"]').on("change",function(){methods.handleInputs($(this))}),_ibThis.find('input[type="text"]').on("change",function(){methods.handleInputs($(this))}),_ibThis.find("select").on("change",function(){methods.handleInputs($(this))}),_ibThis.on("keypress",":input:not(textarea)",function(event){13==event.keyCode&&event.preventDefault()}),_ibThis.find("#cancelButton").click(function(event){event.preventDefault(),methods.confirmCancel()});var $imageUrl=$("#CallToActionNormalCtaImageUrl");$imageUrl.length&&($imageUrl.on("change",function(){methods.setImageProperty($imageUrl("data-state"))}),0==$imageUrl.val().length?methods.resetImageProperty($imageUrl.data("state")):methods.setImageProperty($imageUrl.data("state"),null,null),$("#select_normal_image_button").click(function(e){e.preventDefault(),methods.chooseImage(this.getAttribute("data-state"))})),$('#cta-actions input[type="text"]').trigger("change"),$('#cta-actions input[type="radio"').each(function(){var $me=$(this);$me.is(":checked")&&methods.toggleLinkType($me)}),_hoverStyles=_ibThis.find("#hover_styles"),_hoverStyleTag=_ibThis.find("#hover_state_styles style"),_hoverStylesList=[],_hoverIconStylesList=[],$("#cta_preview .cta-btn").click(function(e){e.preventDefault()})},confirmCancel:function(){$.confirm({title:"Cancel?",content:"Are you sure you want exit? You will lose any changes made.",confirm:function(){window.location.href=settings.cancel_url},confirmButton:"Leave This Page",cancelButton:"Stay",confirmButtonClass:"ib_save",cancelButtonClass:"ib_cancel"})},handleInputs:function($input){methods.chooseStyleMethod($input.data("state"),$input.data("group"),$input.data("property"),$input.val())},chooseStyleMethod:function(state,group,property,value){property=property.replace(new RegExp("_","g"),"-"),stateC=state.charAt(0).toUpperCase()+state.slice(1);var changes=[];switch(group){case"text":switch(property){case"text-decoration":value||(value="none"),changes.push({property:property,value:value});break;case"text-transform":case"font-weight":case"font-style":case"font-family":changes.push({property:property,value:value});break;case"text-shadow":var x=$("#CallToAction"+stateC+"TextTextShadowX").val(),y=$("#CallToAction"+stateC+"TextTextShadowY").val(),blur=$("#CallToAction"+stateC+"TextTextShadowBlur").val(),color=$("#CallToAction"+stateC+"TextTextShadowColor").val();value=x+"px "+y+"px "+blur+"px #"+color,changes.push({property:property,value:value});break;default:property.indexOf("color")==-1?value+="px":value="#"+value,changes.push({property:property,value:value});break;case"text":return void methods.updateCTAText(state)}for(var i in changes){var change=changes[i];methods.updateStyleProperty(state,change.property,change.value)}break;case"icon":"normal"==state?methods.updateCTAText(state):methods.updateIconHover(property,value);break;case"background":switch(property){case"background-top":case"background-bottom":var top=$("#CallToAction"+stateC+"BackgroundBackgroundTop").val(),bottom=$("#CallToAction"+stateC+"BackgroundBackgroundBottom").val();property="background",top.length||(top="FFFFFF"),bottom.length||(bottom="FFFFFF"),value="linear-gradient(#"+top+",#"+bottom+")",changes.push({property:property,value:value});break;case"background":value="#"+value,changes.push({property:property,value:value});break;case"h-padding":value+="px",changes.push({property:"padding-left",value:value}),changes.push({property:"padding-right",value:value});break;case"v-padding":value+="px",changes.push({property:"padding-top",value:value}),changes.push({property:"padding-bottom",value:value})}for(var i in changes){var change=changes[i];methods.updateStyleProperty(state,change.property,change.value)}break;case"border":var trigger=!0;switch(property){case"border-color":value="#"+value,changes.push({property:property,value:value});break;case"border-style":trigger=!1,changes.push({property:property,value:value});break;case"border-top-left-radius":case"border-top-right-radius":case"border-bottom-left-radius":case"border-bottom-right-radius":var top_left=$("#CallToAction"+stateC+"BorderBorderTopLeftRadius").val(),top_right=$("#CallToAction"+stateC+"BorderBorderTopRightRadius").val(),bottom_right=$("#CallToAction"+stateC+"BorderBorderBottomRightRadius").val(),bottom_left=$("#CallToAction"+stateC+"BorderBorderBottomLeftRadius").val();changes.push({property:"border-radius",value:top_left+"px "+top_right+"px "+bottom_right+"px "+bottom_left+"px"});break;default:value+="px",changes.push({property:property,value:value})}for(var i in changes){var change=changes[i];methods.updateStyleProperty(state,change.property,change.value)}trigger&&$("CallToAction"+stateC+"BorderBorderStyle").trigger("change");break;case"actions":methods.updateLinkAttribute(property,value)}},toggleTextTransforn:function($button){var value=($button.data("property"),$button.data("value"));$button.hasClass("ib-active")?($button.removeClass("ib-active"),value=""):$button.addClass("ib-active");var $input=$button.next();$input.val(value).trigger("change")},toggleLinkType:function($input){"internal"==$input.attr("value")?(_ibThis.find("#select_post").show(),_ibThis.find("#choose_custom_url").hide(),$("#CallToActionActionsInternalLink").trigger("change")):(_ibThis.find("#select_post").hide(),_ibThis.find("#choose_custom_url").show(),$("#CallToActionActionsExternalLink").trigger("change"))},toggleBackgroundType:function($input){var state=$input.data("state");"solid"==$input.attr("value")?(_ibThis.find("#"+state+"_background_solid").show(),_ibThis.find("#"+state+"_background_gradient").hide()):(_ibThis.find("#"+state+"_background_solid").hide(),_ibThis.find("#"+state+"_background_gradient").show())},toggleHoverState:function($input){var $options=$input.parent().next();$input.is(":checked")?($options.show(),methods.copyHoverStateOptions($options,$input.data("group"))):($options.hide(),methods.removeHoverStateOptions($options))},copyHoverStateOptions:function($options,group){if($options.find("input,select").each(function(){var $me=$(this),fieldId=$me.attr("id"),normalId=fieldId.replace("Hover","Normal"),$normalField=$("#"+normalId);$normalField.val();$me.val($normalField.val())}),$options.find(".ib_cta-transform").each(function(){var $me=$(this);$me.next().val().length>0?$me.addClass("ib-active"):$me.removeClass("ib-active")}),$options.find(".ib-slider").each(function(){var $slider=$(this);$input=$slider.prev().find("input"),$slider.slider("value",$input.val())}),"text"==group){var $normalIcon=_ibThis.find("#IconPickerNormal"),$hoverIcon=_ibThis.find("#IconPickerHover");$hoverIcon.find(".ib_icon_name").html($normalIcon.find(".ib_icon_name").html()),$hoverIcon.find(".icon").html($normalIcon.find(".icon").html())}},removeHoverStateOptions:function($options){},updateSliderLinkedTextfield:function($slider){$input=$slider.prev().find("input");var value=$slider.slider("option","value");$input.val()!=value&&($input.val(value),$input.trigger("change"))},updateTextLinkedSliderScrubber:function($input){$slider=$input.parent().next(),console.log($slider),$slider.slider("value")!=$input.val()&&$slider.slider("value",$input.val())},updateStyleProperty:function(state,property,value){"normal"==state?(_ctaPreviewButton.css(property,value),methods.updateHtmlPreview()):methods.setHoverStyleProperty(property,value)},updateCTAText:function(state){var stateC=state.charAt(0).toUpperCase()+state.slice(1),text=$("#CallToAction"+stateC+"TextButtonText").val();if(!text)var text=$("#CallToAction"+stateC+"TextTopText").val();var icon=$("#CallToAction"+stateC+"IconIcon").val(),color=$("#CallToAction"+stateC+"IconColor").val(),iconStr="",pos=$("#CallToAction"+stateC+"IconPosition").val(),textStr="";if(icon.length){color=color?'style="color:#'+color+'"':"";var iconStr='<span class="'+icon+'" '+color+"> </span>";textStr="left"==pos?iconStr+" "+text:text+" "+iconStr}else textStr=text;_ctaPreviewButton.html(textStr),methods.updateHtmlPreview()},updateLinkAttribute:function(attribute,value){_ctaPreviewButton.attr(attribute,value),methods.updateHtmlPreview()},updateHtmlPreview:function(){_htmlPreview.val(_previewHolder.html())},resetImageProperty:function(state){var stateC=state.charAt(0).toUpperCase()+state.slice(1);$("#CallToAction"+stateC+"UploadImageId").val(),$("#CallToAction"+stateC+"CtaImageUrl").val(),$("#CallToAction"+stateC+"CtaThumbnail").val(),$("#"+state+"_cta_thumbnail").html('<img src="'+settings.no_image_thumbnail+'">'),"normal"==state&&_ctaPreviewButton.html("&nbsp;"),methods.updateHtmlPreview()},chooseImage:function(state){var stateC=state.charAt(0).toUpperCase()+state.slice(1);_mediaWindow&&_mediaWindow.open(),_mediaWindow=wp.media.frames._mediaWindow=wp.media({title:"Choose CTA Image",button:{text:"Choose Selected"},multiple:!1}),_mediaWindow.on("select",function(){attachment=_mediaWindow.state().get("selection").first().toJSON();var imgurl=attachment.url,thumbnail=attachment.sizes.thumbnail.url,aid=attachment.id;_ibThis.find("#CallToAction"+stateC+"UploadImageId").val(aid),_ibThis.find("#CallToAction"+stateC+"CtaImageUrl").val(imgurl),_ibThis.find("#CallToAction"+stateC+"CtaThumbnail").val(thumbnail),methods.setImageProperty(state,thumbnail,imgurl)}),_mediaWindow.open()},setImageProperty:function(state,thumbnail,image_url){var stateC=state.charAt(0).toUpperCase()+state.slice(1);thumbnail||(thumbnail=_ibThis.find("#CallToAction"+stateC+"CtaThumbnail").val()),image_url||(image_url=_ibThis.find("#CallToAction"+stateC+"CtaImageUrl").val()),_ibThis.find("#"+state+"_cta_thumbnail").html('<img src="'+thumbnail+'">');var img_cta='<img src="'+image_url+'" alt="Submit">';_ctaPreviewButton.html(img_cta),methods.updateHtmlPreview()},setHoverStyleProperty:function(property,value){_hoverStylesList[property]=value,methods.applyHoverStyles()},applyHoverStyles:function(){var styles="",iconStyles="";for(var i in _hoverStylesList){var property=i,value=_hoverStylesList[i];styles+=property+":"+value+" !important;"}for(var i in _hoverIconStylesList){var property=i,value=_hoverIconStylesList[i];iconStyles+=property+":"+value+" !important;"}var css="#cta_preview .cta-btn:hover{"+styles+"}";css+="#cta_preview .cta-btn:hover span{"+iconStyles+"}",_hoverStyleTag.html(css),_hoverStyles.val(css)},updateIconHover:function(property,value){_hoverIconStylesList[property]="#"+value,methods.applyHoverStyles()}},settings=$.extend({},defaults,method);return methods[method]?(_ibThis=$(this),methods[method].apply(this,Array.prototype.slice.call(arguments,1))):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.ib_ctaEditor"):this.each(function(){_ibThis=$(this),methods.init()})}}(jQuery);