!function($){"undefined"!=typeof ibCtaShortCode&&(tinymce.PluginManager.add("ib_cta_sc_button",function(ed,url){function _do_cta_preview(co){var cta=[];return $.each(ibCtaShortCode.Codes,function(index){cta.push(this.cta_id)}),co.replace(/\[brew_cta([^\]]*)\]/g,function(a,b){var cta_id=tinymce.DOM.encode(b).split("="),new_cta_id=parseInt(cta_id[1].match(/\d+/)[0]);return $.inArray(new_cta_id,cta)>-1?'<input type="button" class="ibCTAPreview mceItem" value="" disabled="disabled" title="brew_cta'+tinymce.DOM.encode(b)+'" />':($(".cta-selected,.remove-top-cta").remove(),$.ajax({type:"POST",dataType:"json",url:ibCtaShortCode.ajaxurl,data:{action:"display_preview_cta",cta_shortcode:tinymce.DOM.encode(a)},success:function(res){var trashIcon="<a data-content='"+tinymce.DOM.encode(a)+"' class='remove-top-cta ib_icon-link delete fa fa-trash ib_delete-cta' title='Remove this CTA'></a>";$("#wp-content-wrap").html()&&$("<div class='cta-selected'>"+res+"</div>"+trashIcon).insertBefore("#wp-content-wrap"),$("#wp-ib_lp_column_1-wrap").html()&&$("<div class='cta-selected'>"+res+"</div>"+trashIcon).insertBefore("#wp-ib_lp_column_1-wrap")}}),'<input style="display:none;" type="button" class="ibCTAPreview mceItem" value="" disabled="disabled" title="brew_cta'+tinymce.DOM.encode(b)+'" />')})}function _get_cta_id(co){function getAttr(s,n){return n=new RegExp(n+'="([^"]+)"',"g").exec(s),n?tinymce.DOM.decode(n[1]):""}return co.replace(/(<input[^>]+>)*/g,function(a,im){var cls=getAttr(im,"class");return cls.indexOf("ibCTAPreview")!=-1?"["+tinymce.trim(getAttr(im,"title"))+"]":a})}var base_url="/wp-content/plugins/inbound-brew/src/Modules/CTA/assets/tinymce/",base_url="/wp-content/plugins/inbound-brew-pro/src/Modules/CTA/assets/tinymce/",choose_page="choose_cta.html",t=this;t.url=url,ed.on("BeforeSetContent",function(event){event.content=_do_cta_preview(event.content)}),ed.on("ExecCommand",function(ed,cmd){"mceInsertContent"===cmd&&tinyMCE.activeEditor.setContent(t._do_cta_preview(tinyMCE.activeEditor.getContent()))}),ed.on("PostProcess",function(event){event.get&&(event.content=_get_cta_id(event.content))}),values=[],ed.addButton("ib_cta_sc_button",{text:"CTA's",icon:!1,onclick:function(){ed.windowManager.open({title:"Choose CTA",url:base_url+choose_page,width:800,height:400},{cta_codes:ibCtaShortCode.Codes})}}),ed.addButton("ib_cta_top_bar_button",{text:"Top CTA's",icon:!1,onclick:function(){ed.windowManager.open({title:"Choose Top Bar CTA",url:base_url+choose_page,width:800,height:400},{cta_codes:ibCtaShortCode.TopCodes})}}),ed.addButton("ib_cta_before_leave_button",{text:"Before Leave CTA's",icon:!1,onclick:function(){ed.windowManager.open({title:"Choose Before Leave CTA",url:base_url+choose_page,width:800,height:400},{cta_codes:ibCtaShortCode.BeforeLeave})}})}),$(document).on("click",".remove-top-cta",function(){var cta=$(this).data("content");tinyMCE.activeEditor.setContent(tinyMCE.activeEditor.getContent().replace(cta,"")),$(".cta-selected,.remove-top-cta").remove()}))}(jQuery);