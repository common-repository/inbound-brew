!function($){$.fn.ib_redirects=function(method){var _ibThis,_newRedirects,defaults={data:"",delete_confirm_message:"Are you sure you want to delete this redirect?",confirm_edit_cancel:"Are you sure you want to cancel editing this redirect?"},methods={init:function(options){$ib_postTypeSelect=$("#RedirectRedirectType"),$ib_postTypeSelect.change(function(){methods.onPostTypeChange($(this))}),methods.onPostTypeChange($ib_postTypeSelect),$ib_submitButton=settings.redirect_submit,$ib_submitButton.click(function(e){e.preventDefault(),methods.handleRedirectForm($(this).closest("form"))}),_ibThis.find("a.delete").click(function(e){e.preventDefault(),methods.deleteRedirect($(this).attr("data-id"))});var $editCancelButton=$("#ibEditCancel");$editCancelButton.length&&$editCancelButton.click(function(e){e.preventDefault(),methods.confirmEditCancel()}),_newRedirects=_ibThis.find("#new_redirects_list"),methods.assignRowBehaviors(_newRedirects.children().first()),_ibThis.on("keypress",":input",function(event){13==event.keyCode&&event.preventDefault()}),_ibThis.find(".ib_edit-button").each(function(){$(this).click(function(e){e.preventDefault(),methods.editRedirect($(this).closest("tr"),!0)})}),_ibThis.find("#ib_redirect_list .ib_cancel").each(function(){$(this).click(function(e){e.preventDefault(),methods.editRedirect($(this).closest("tr"),!1)})}),_ibThis.find("#ib_redirect_list .ib_save").each(function(){$(this).click(function(e){e.preventDefault(),methods.saveEditRedirect($(this).closest("tr").find("form"))})}),_ibThis.find("#ib_redirect_list tr").each(function(){var $select=$(this).find("#redirect_type_select");$select.on("change",function(){methods.onPostTypeChange($(this))}),$select.trigger("change")}),_ibThis.find(".ib_data-tables").DataTable({columnDefs:[{targets:[-1],orderable:!1}],pageLength:25})},editRedirect:function($row,edit){edit?($row.find("td .ib_display").hide(),$row.find("td .form-field").show()):($row.find("td .ib_display").show(),$row.find("td .form-field").hide())},assignRowBehaviors:function($row){$row.find("#redirect_type_select").on("change",function(){methods.onPostTypeChange($(this))}).trigger("change"),$row.find("#add_new_redirect_row_button").click(function(e){e.preventDefault(),methods.addNewRedirectRow()}).show(),$row.find("#is_wildcard").blur(function(e){var $button=$(this).closest("tr").find("#add_new_redirect_row_button");$button.is(":visible")&&$button.trigger("click")});var $first=$row.find("#Redirect"+_rowCount+"RedirectFrom");$first.val(""),$first.focus();var $deleteBtn=$row.find("#delete_row");$row.find("#Redirect"+_rowCount+"UrlOptions").val(""),$deleteBtn.click(function(e){e.preventDefault(),methods.deleteNewRedirect($(this).closest("tr"))}),_rowCount&&$deleteBtn.show()},addNewRedirectRow:function(){_rowCount++;var $clone=_newRedirects.children().first().clone();_newRedirects.append($clone);var $prev=$clone.prev();$prev.length&&$prev.find("#add_new_redirect_row_button").hide(),$clone.find("input,select").each(function(){var $me=$(this),id=$me.attr("id"),name=$me.attr("name");id=id.replace("0",_rowCount);var name=name.replace("[0]","["+_rowCount+"]");$me.attr("id",id),$me.attr("name",name)}),methods.assignRowBehaviors($clone)},deleteNewRedirect:function($row){var $addButton=$row.find("#add_new_redirect_row_button");$addButton.is(":visible")&&($row.prev().find("#add_new_redirect_row_button").show(),$row.fadeOut("fast",function(){$(this).remove()}))},confirmEditCancel:function(){$.confirm({title:"Cancel Edit Redirect?",content:settings.confirm_edit_cancel,confirm:function(){window.history.back()},confirmButton:"YES",cancelButton:"NO",confirmButtonClass:"ib_save",cancelButtonClass:"ib_cancel"})},onPostTypeChange:function($select){var postType=$select.val();$select.parent().parent().find("#ib_post-type-options").children().each(function(){var $me=$(this),id=$me.attr("id");id=="ib_"+postType+"_options"?$me.show():$me.hide()})},deleteRedirect:function(redirect_id){_lockClick||(_lockClick=!0,$.confirm({title:"Delete Redirect?",content:settings.delete_confirm_message,confirm:function(){var post={nonce:ibKwAjax.ibKwNonce,redirect_id:redirect_id,action:"ib_delete_redirect"};$.ajax({url:ibKwAjax.ajaxurl,dataType:"json",type:"post",data:post,success:function(responseText,status){1==responseText.type?$("#ib_redirect-row-"+redirect_id).fadeOut("slow",function(){_lockClick=!1,$(this).remove(),methods.updateAltRows()}):_lockClick=!1},error:function(jqXhr,textStatus,errorThrown){console.log(errorThrown)}})},cancel:function(){_lockClick=!1},confirmButtonClass:"ib_save",cancelButtonClass:"ib_cancel"}))},updateAltRows:function(){var i=0;$("#ib_redirect-list tr").each(function(){var rowClass="";i%2==0&&(rowClass="alt0"),$(this).attr("class",rowClass),i++})},handleRedirectForm:function($form){var validator=new Validator($form);validator.validate(),validator.validForm?$form.submit():$.alert({title:"Error!",content:"There was an error with your form. Check data and try again.",confirmButtonClass:"ib_save"})},saveEditRedirect:function($form){if(!_lockClick){_lockClick=!0;var validator=new Validator($form);validator.validate(),validator.validForm?$.ajax({url:ibKwAjax.ajaxurl,dataType:"json",type:"post",data:$form.serialize()+"&nonce="+ibKwAjax.ibKwNonce,success:function(response,status){if(1==response.success){var $row=$form.parent();for(var i in response.redirect)$row.find("#disp_"+i).html(response.redirect[i]);methods.editRedirect($row,!1)}else $.alert({title:"Error!",content:response.message,confirmButtonClass:"ib_save"});_lockClick=!1},error:function(jqXhr,textStatus,errorThrown){console.log(errorThrown),_lockClick=!1}}):$.alert({title:"Error!",content:"There was an error with your form. Check data and try again.",confirmButtonClass:"ib_save"})}}},_lockClick=!1,settings=$.extend({},defaults,method),_rowCount=0;return methods[method]?(_ibThis=$(this),methods[method].apply(this,Array.prototype.slice.call(arguments,1))):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.ib_redirects"):this.each(function(){_ibThis=$(this),methods.init()})}}(jQuery);