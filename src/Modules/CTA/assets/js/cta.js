jQuery(document).ready(function($){function updatePreviewStyle(prop,value){var obj={},val="",prop=prop.replace("_","-");switch(prop){case"border":var border_size=value?value+"px":"0px",border_color=$("#border-color").val()?$("#border-color").val():"FFF";obj.border=border_size+" solid #"+border_color;break;case"border-color":var border_size=$("#border").val()?$("#border").val()+"px":"0px",border_color=value?value:"FFF";obj.border=border_size+" solid #"+border_color;break;case"border-radius":case"font-size":val=value+"px",obj[prop]=val;break;case"font-family":val=value,obj[prop]=val;break;case"h-padding":val=value+"px",obj["padding-right"]=val,obj["padding-left"]=val;break;case"v-padding":val=value+"px",obj["padding-top"]=val,obj["padding-bottom"]=val;break;case"color":val="#"+value,obj[prop]=val;break;case"background-color":if(!$("#ib_bgr_type_solid").is(":checked"))return;val="#"+value,obj.background=val;break;case"background":if(!$("#ib_bgr_type_gradient").is(":checked"))return;val=value,obj[prop]=val;default:val=value,obj[prop]=val}$.each(obj,function(key,value){$('#button-area [data-role="cta-button"]').css(key,value)}),copyPreview(),$("#ib_cta").validate({rules:{post_title:"required",button_text:{required:function(element){return $("#cta_type_button").is(":checked")}},external_link_text:{required:function(element){return $("#target_external").is(":checked")}}},submitHandler:function(form){$("#submit_form").css("opactity",".5").prop("disabled",!0),form.submit()}})}function updatePreviewValue(type,val){"text"==type&&$('#button-area [data-role="cta-button"]').text(val),"image"==type&&$('#button-area [data-role="cta-button"]').html(val),copyPreview()}function updatePreviewTarget(attr,$e){$('#button-area a[data-role="cta-button"]').attr(attr,$e.val()),copyPreview()}function copyPreview(){if($("#cta-display-wrapper").length){var $wrapper=$("#cta-display-wrapper");$("#ib_post_content").val($wrapper.html().trim())}}function resetPreview(){$("#cta-display-wrapper a").removeAttr("style"),copyPreview()}function ib_loadPresets(){$('#cta_tabs input[type="text"],#cta_tabs input[type="hidden"], #cta_tabs #font_family').each(function(){var $input=$(this),key=$input.attr("name"),value=$input.val(),dataType=$input.attr("data-type"),prop=$input.attr("data-name");switch("undefined"==typeof prop&&(prop=$input.attr("name")),dataType){case"slider":$("#ib_slider-"+prop).slider("value",value);break;case"color-picker":$input.colpickSetColor(value,!0);break;default:switch(key){case"button_text":updatePreviewValue("text",value);break;case"cta_type":break;default:updatePreviewStyle(prop,value)}}})}function ib_saveAsTemplateConfirm(){$.confirm({title:"New Template",content:"<div id='confirm_template_name'>"+$("#template_name").html()+"</div>",confirm:function(){var name=$("#confirm_template_name input").val(),settings={};$("#cta_tabs input,#cta_tabs select").each(function(){var $input=$(this),key=$input.attr("name"),type=$input.attr("type"),value=$input.val();"radio"==type||"checkbox"==type?$input.is(":checked")&&(settings[key]=value):settings[key]=value}),ib_saveTemplate(name,settings,"ib_save_as_cta_template",0)},confirmButton:"SAVE",cancelButton:"CANCEL"})}function ib_deleteTemplate(){_lockClick||(_lockClick=!0,$.confirm({title:"Delete Template",content:"Are you sure you want to delete this template?",confirm:function(){window.location.href=$("#delete_template").attr("href")},cancel:function(){_lockClick=!1},confirmButton:"DELETE",cancelButton:"CANCEL"}))}function ib_updateTemplate($submitBtn){if(!_lockClick){_lockClick=!0,$submitBtn.addClass("disabled"),$submitBtn.prev().addClass("is-active");var name=$("#title").val(),settings={};$("#cta_tabs input,#cta_tabs select").each(function(){var $input=$(this),key=$input.attr("name"),type=$input.attr("type"),value=$input.val();"radio"==type||"checkbox"==type?$input.is(":checked")&&(settings[key]=value):settings[key]=value}),ib_saveTemplate(name,settings,"ib_update_cta_template",$submitBtn.attr("data-id"))}}function ib_saveTemplate(name,settings,action,template_id){var post={nonce:ibKwAjax.ibKwNonce,name:name,template_id:template_id,settings:settings,action:action,html:$("#ib_post_content").val()};$.ajax({url:ibKwAjax.ajaxurl,dataType:"json",type:"post",data:post,success:function(responseText,status){1==responseText.type?a_title="Success!":a_title="Error!",responseText.redirect.length>0?window.location.href=responseText.redirect:$.alert({title:a_title,content:responseText.message}),_lockClick=!1},error:function(jqXhr,textStatus,errorThrown){console.log(errorThrown),_lockClick=!1}})}function ib_chooseTemplate(){$.ajax({url:ibKwAjax.ajaxurl,dataType:"html",type:"post",data:{nonce:ibKwAjax.ibKwNonce,action:"ib_choose_cta_template"},success:function(response,status){var $dialog=$("#dialog");$dialog.dialog("option","title","Choose Template"),$("#dialog-body").html(response),$dialog.dialog("open")},error:function(jqXhr,textStatus,errorThrown){$.alert({title:"Error",content:"Unable to load templates. Please try again."})}})}function ib_applyCTATemplate(template){var settings=template.settings,cta_type=settings.cta_type;$("#cta_type_"+cta_type).trigger("click");var bgr_type=settings.cta_bgr_type;$("#ib_bgr_type_"+bgr_type).trigger("click");var cta_link=settings.cta_link;$("#target_"+cta_link).trigger("click"),settings.font_weight.length?($("#font_weight-input").val("1"),$("#font_weight-button").addClass("ib-active")):($("#font_weight-input").val(""),$("#font_weight-button").removeClass("ib-active")),updatePreviewStyle("font_weight",settings.font_weight),settings.font_style.length?($("#font_style-input").val("1"),$("#font_style-button").addClass("ib-active")):($("#font_style-input").val(""),$("#font_style-button").removeClass("ib-active")),updatePreviewStyle("font_style",settings.font_style),settings.text_transform.length?($("#text_transform-input").val("1"),$("#text_transform-button").addClass("ib-active")):($("#text_transform-input").val(""),$("#text_transform-button").removeClass("ib-active")),updatePreviewStyle("text_transform",settings.text_transform),$('#cta_tabs input[type="text"],#cta_tabs input[type="hidden"], #cta_tabs #font_family').each(function(){var $input=$(this),key=$input.attr("name"),value=settings[key];$input.val(value);var dataType=$input.attr("data-type"),prop=$input.attr("data-name");switch("undefined"==typeof prop&&(prop=$input.attr("name")),dataType){case"slider":$("#ib_slider-"+prop).slider("value",value);break;case"color-picker":$input.colpickSetColor(value,!0);break;default:switch(key){case"button_text":updatePreviewValue("text",value);break;case"cta_type":break;default:updatePreviewStyle(prop,value)}}})}function ib_checkIfSelectedImage(){resetPreview();var imgurl=$("#cta_image_url").val();if(imgurl){var img_cta='<img src="'+imgurl+'" alt="Submit">';updatePreviewValue("image",img_cta)}}var _lockClick=!1;window.ib_onCTATemplateChoosen=function(template_id){$("#dialog").dialog("close"),$.ajax({url:ibKwAjax.ajaxurl,dataType:"json",type:"post",data:{nonce:ibKwAjax.ibKwNonce,action:"ib_load_cta_template_data",template_id:template_id},success:function(response,status){if(1==response.type){var template=response.template;ib_applyCTATemplate(template)}else $.alert({title:"Error!",content:response.message})},error:function(jqXhr,textStatus,errorThrown){$.alert({title:"Error!",content:"Unable to load template. Please try again."})}})},$("#save_as_template").click(function(e){if(e.preventDefault(),$(this).hasClass("disabled"))$.alert({title:"Can't save template",content:"Image type CTA's cannot be saved as a template."});else{if(_lockClick)return;_lockClick=!0,ib_saveAsTemplateConfirm()}}),$("#load_from_template").click(function(e){e.preventDefault(),ib_chooseTemplate()}),$("#dialog").dialog({title:"Choose Template",autoOpen:!1,width:600}),$(".ui-slider").each(function(){$(this).slider({min:$(this).data("min")||0,max:$(this).data("max")||100,value:$(this).data("value")||0,change:function(event,slider){var $slider=$(this),prop=$slider.attr("data-name"),value=$slider.slider("option","value"),$input=$('input[data-name="'+prop+'"]');$input.val(value),updatePreviewStyle(prop,value)}})}),$("#ib_bgr_type_solid,#ib_bgr_type_gradient").each(function(){var $me=$(this);$me.click(function(){var value=$(this).val();"solid"==value?($(".ib_cta-bgr-solid-row").show(),$(".ib_cta-bgr-gradient-row").hide(),updatePreviewStyle("background_color",$("#background-color").val())):($(".ib_cta-bgr-solid-row").hide(),$(".ib_cta-bgr-gradient-row").show(),updatePreviewStyle("background_bottom",$("#background-bottom").val()),updatePreviewStyle("background_top",$("#background-top").val()))}),$me.is(":checked")&&$me.trigger("click")});var $colorPickers=$('[data-type="color-picker"]');$colorPickers.each(function(){var $me=$(this);$me.after('<span class="ib_color-pick">&nbsp;</span>');var prevColor=$me.val(),$colorPreview=$me.next(".ib_color-pick");prevColor.length&&$colorPreview.css("background-color","#"+prevColor),$colorPreview.click(function(){$(this).prev('[data-type="color-picker"]').trigger("click")}),$me.colpick({layout:"hex",submit:0,colorScheme:"dark",onChange:function(hsb,hex,rgb,el,bySetColor){var $el=$(el);$el.next(".ib_color-pick").css("background-color","#"+hex),$el.val(hex);var property=$el.data("name"),value=$el.val();if(0!=$('[data-role="cta-button"]').length){var group=$el.data("propGroup");if($el.attr("data-prop-group")&&"gradient"==$el.data("propGroup")){property="background";var arr=[];$('[data-prop-group="'+group+'"]').each(function(){arr.push("#"+$(this).val())}),value="linear-gradient("+arr.join()+")"}updatePreviewStyle(property,value)}}})}).keyup(function(){$(this).colpickSetColor(this.value)}),$("#cta-settings-container").on("slidechange",function(e){var $slider=$(e.target),$parent=$(e.delegateTarget),name=$slider.data("name"),$input=$(':input[name="'+name+'"]',$parent);if($input.val($slider.slider("value")),0!=$('[data-role="cta-button"]').length)if($input.attr("data-prop-group")&&"border"==$input.attr("data-prop-group")){var group=$input.data("propGroup");$('[data-prop-group="'+group+'"]').each(function(){updatePreviewStyle($(this).attr("name"),$(this).val())})}else updatePreviewStyle(name,$slider.slider("value"))}),$("#font_family").on("change",function(e){var $input=$(this);updatePreviewStyle($input.data("name"),$input.val())}),$("#font_size").on("keyup",function(e){var $input=$(this);updatePreviewStyle($input.attr("name"),$input.val())}),$ibTransforms=$(".ib_cta-transform"),$ibTransforms.each(function(){var $me=$(this);$me.click(function(){var $button=$(this),property=$button.attr("data-name"),value=$button.attr("data-item"),$input=$button.prev();$button.hasClass("ib-active")?(value="",$input.val(""),$button.removeClass("ib-active")):($input.val($button.attr("data-item")),$button.addClass("ib-active")),updatePreviewStyle(property,value)})}),$('#cta-settings-container [data-role-group="font-props"]').on("click",function(e){var $elm=$(e.target);updatePreviewStyle($elm.data("name"),$elm.is(":checked")?$elm.data("item"):"")}),$("#button_text").on("keyup",function(e){updatePreviewValue("text",$(this).val())}),$('[data-role="cta-link"] :input').on("blur change keyup",function(e){updatePreviewTarget("href",$(e.target))}),$('[data-role="cta-target-type"]').on("click",function(e){updatePreviewTarget("target",$(e.target))}),$("#external_link_text").on("blur change keyup",function(e){var $me=$(this),property=$me.attr("name");updatePreviewTarget(property,$me)}),$("#external_link_text").on("blur change keyup",function(e){var $me=$(this);updatePreviewTarget("href",$me)}),$("#alt_copy,#title_copy").trigger("change"),$("#cta_type_button,#cta_type_image").each(function(){var $me=$(this);$me.click(function(){var value=$(this).val();"button"==value?($("#cta_tabs a.background,#cta_tabs a.border").removeClass("disabled"),$(".ib_cta_type_button-row").slideDown("fast"),$(".ib_cta_type_image-row").slideUp("fast"),$("#save_as_template").removeClass("disabled"),ib_loadPresets()):($("#cta_tabs a.background,#cta_tabs a.border").addClass("disabled"),$(".ib_cta_type_button-row").slideUp("fast"),$(".ib_cta_type_image-row").slideDown("fast"),$("#save_as_template").addClass("disabled"),ib_checkIfSelectedImage())}),$me.is(":checked")&&$me.trigger("click")}),$("#target_internal,#target_external").each(function(){var $me=$(this);$me.click(function(){if($(this).is(":checked")){var value=$(this).val();"internal"==value?($("#target_internal_options").show(),$("#target_external_options").hide(),updatePreviewTarget("href",$("#internal_link_select"))):($("#target_internal_options").hide(),$("#target_external_options").show(),updatePreviewTarget("href",$("#external_link_text")))}}),$me.is(":checked")&&$me.trigger("click")}),$("#internal_link_select").change(function(){updatePreviewTarget("href",$(this))});var file_frame;$("#set-cta-image").click(function(e){e.preventDefault(),file_frame&&file_frame.open(),file_frame=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),button:{text:jQuery(this).data("uploader_button_text")},multiple:!1}),file_frame.on("select",function(){attachment=file_frame.state().get("selection").first().toJSON();var imgurl=attachment.url,thumbnail=attachment.sizes.thumbnail.url,aid=attachment.id,$preview=$("#cta_image_preview");$preview.find(".cta-thumbnail").html('<img src="'+thumbnail+'"/>'),$preview.find("#cta_image_url").val(imgurl),$preview.find("#cta_thumbnail").val(thumbnail),$("#upload_image_id").val(aid),$preview.show();var img_cta='<img src="'+imgurl+'" alt="Submit">';updatePreviewValue("image",img_cta)}),file_frame.open()}),$("#remove-cta-image").click(function(e){e.preventDefault();var $preview=$("#cta_image_preview");return $preview.find(".cta-thumbnail").html(""),$("#upload_image_id").val(""),$preview.find("#cta_thumbnail").val(""),$preview.find("#cta_image_url").val(""),updatePreviewValue("text",""),!1}),$("#submitTemplateDiv").length>0&&($("#delete_template").click(function(e){e.preventDefault(),ib_deleteTemplate()}),$("#publish").click(function(e){e.preventDefault(),ib_updateTemplate($(this))}))});