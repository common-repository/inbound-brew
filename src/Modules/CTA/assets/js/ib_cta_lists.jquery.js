!function($){$.fn.ib_ctaLists=function(method){var _ibThis,_dataTable,_clipboard,_ctaListOptions,defaults={data:"",list:"cta",spinner:'<span class="fa fa-spinner fa-pulse fa-2x"></span>',post_type:"",blog_url:""},methods={init:function(options){switch(settings.list){case"templates":_dataTable=_ibThis.DataTable({columnDefs:[{orderable:!1,targets:[0]}],order:[[1,"desc"]],pageLength:25}),$(".delete-template").each(function(){$(this).click(function(e){e.preventDefault(),methods.deleteTemplateConfirm($(this))})});var $list=_ibThis.find("tbody");$list.on("click","td.details-control",function(){var $tr=$(this).closest("tr"),type=$tr.attr("data-type");"template_ctas"==type?methods.toggleTemplateRow($tr):methods.toggleCtaRow($tr)}),$list.on("click",".ib_delete-from-post",function(e){e.preventDefault(),methods.confirmDeleteCtaFromPost($(this).closest("tr"))}),$list.on("click",".delete-template-cta",function(e){e.preventDefault(),methods.confirmDeleteTemplateCta($(this).closest("tr"))});break;case"cta":_ibThis.find(".ib_data-tables").DataTable({columnDefs:[{orderable:!1,targets:[0,2,3]}],order:[[2,"asc"]],pageLength:25,asStripeClasses:[]}),_ibThis.find(".ib_delete-cta").each(function(){$(this).click(function(e){var $me=$(this);e.preventDefault(),$.confirm({title:"Delete CTA?",content:"Are you sure you want to delete this CTA. This will also remove all shortcodes in pages/posts.",confirm:function(){window.location.href=$me.attr("href")},cancel:function(){_lockClick=!1},confirmButton:"DELETE",cancelButton:"CANCEL",confirmButtonClass:"ib_save",cancelButtonClass:"ib_cancel"})})});break;case"choose_template":_ibThis.find(".ib_data-tables").DataTable({order:[[1,"desc"]],columnDefs:[{orderable:!1,targets:[0,2]}],pageLength:25,asStripeClasses:[]})}methods.setClipboard(),_ibThis.find(".ib-cta_preview-list").click(function(e){e.preventDefault();var url=$(this).attr("data-url");window.location=url}),_ctaListOptions=$("#ib_new_cta_options"),_ctaListOptions.on("mouseover",function(){$(this).find("ul").stop().slideDown("slow")}),$(document).on("mousedown",function(){_ctaListOptions.find("ul").stop().slideUp("slow")}),_ctaListOptions.find("li").click(function(){var href=$(this).data("href");window.location.href=href})},setClipboard:function(){void 0!=_clipboard&&_clipboard.destroy(),_clipboard=new Clipboard(".ib_short-code",{text:function(trigger){return trigger.getAttribute("data-shortcode")}}),_clipboard.on("success",function(e){e.clearSelection(),e.trigger.setAttribute("title","Copied!"),$(e.trigger).tipsy("show")});var $shortCodes=_ibThis.find(".ib_short-code");$shortCodes.tipsy({tigger:"manual"}),$shortCodes.mouseleave(function(){$(this).attr("original-title",""),$(this).tipsy("hide")}).mouseenter(function(){$(this).attr("original-title","Copy to Clipboard"),$(this).tipsy("show")})},toggleCtaRow:function($tr){var cta_id=$tr.attr("data-id");if($tr.hasClass("shown")){$tr.removeClass("shown");var $details_row=$tr.parent().find("#cta_details_"+cta_id);return void $details_row.slideUp("fast",function(){$tr.find("td.details-control span").attr("class","fa fa-chevron-right"),console.log($(this)),$(this).remove()})}$.ajax({type:"POST",dataType:"json",url:ibTopNavAjax.ajaxurl,data:{action:"ib_load_cta_links",cta_id:cta_id},success:function(links){if($tr.addClass("shown"),$tr.find("td.details-control span").attr("class","fa fa-chevron-down"),links.length)var details=methods.formatCtaDetails(links);else var details="<h3>This CTA has not been added to any page or post.</h3>";var html='<tr id="cta_details_'+cta_id+'"><td class="ib_cta-links" colspan="8">'+details+"</td></tr>";$tr.after(html)}})},toggleTemplateRow:function($tr){var template_id=$tr.attr("data-id"),$row=_dataTable.row($tr);return $row.child.isShown()?($row.child.hide(),$tr.removeClass("template-details-shown"),void $tr.find("td.details-control span").attr("class","fa fa-chevron-right")):void $.ajax({type:"POST",dataType:"json",url:ibTopNavAjax.ajaxurl,data:{action:"ib_load_template_ctas",template_id:template_id},success:function(ctas){$tr.find("td.details-control span").attr("class","fa fa-chevron-down"),$tr.addClass("template-details-shown");var parentClass=$tr.hasClass("odd")?"odd":"even";if(ctas.length)var details=methods.formatTemplateDetails(ctas);else var details="<h3 style='margin-left:4%'>No CTA's associated with this Template.</h3>";$row.child(details,"ib_template_details_row "+parentClass).show(),methods.setClipboard()}})},formatTemplateDetails:function(ctas){var html='<table cellspacing="0" cellpadding="0" class="ib_row-details">\t\t\t\t\t\t\t<thead>\t\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t\t<th width="5%">#</th>\t\t\t\t\t\t\t\t\t<th width="17%" class="text-left">Title</th>\t\t\t\t\t\t\t\t\t<th width="19%">Links To</th>\t\t\t\t\t\t\t\t\t<th width="15%">Last Updated</th>\t\t\t\t\t\t\t\t\t<th width="8%">Pages On</th>\t\t\t\t\t\t\t\t\t<th width="20%">Short Code</th>\t\t\t\t\t\t\t\t\t<th>&nbsp;</th>\t\t\t\t\t\t\t\t\t<th>&nbsp;</th>\t\t\t\t\t\t\t</tr></thead>\t\t\t\t\t\t\t<tbody>';for(var i in ctas){var cta=ctas[i],edit_url="admin.php?page="+settings.post_type+"&section=ib_edit_cta&cta_id="+cta.cta_id,clone_url="admin.php?page="+settings.post_type+"&section=ib_clone_cta&cta_id="+cta.cta_id;html+='<tr id="cta_'+cta.cta_id+'" data-id="'+cta.cta_id+'" data-type="cta_pages">\t\t\t\t\t\t<td>'+cta.cta_id+"</td>\t\t\t\t\t\t<td>"+cta.name+'</td>\t\t\t\t\t\t<td><a href="'+cta.link_url+'" class="text-link">'+cta.link_title+"</a></td>\t\t\t\t\t\t<td>"+cta.updated_at+'</td>\t\t\t\t\t\t<td id="pages_on">'+cta.pages_on+'</td>\t\t\t\t\t\t<td><span class="ib_short-code" title="Copy to Clipboard" data-shortcode=\'[brew_cta id="'+cta.cta_id+'"]\'>[brew_cta id="'+cta.cta_id+'"]</span></td>\t\t\t\t\t\t<td class="ib_tools">\t\t\t\t\t\t\t<a href="'+clone_url+'" class="ib_icon-link fa fa-clone"></a>\t\t\t\t\t\t\t<a href="'+edit_url+'" class="ib_icon-link fa fa-pencil"></a>\t\t\t\t\t\t\t<a href="" class="ib_icon-link delete fa fa-trash delete-template-cta"></a>\t\t\t\t\t\t</td>\t\t\t\t\t\t<td class="details-control">\t\t\t\t\t\t\t<span class="fa fa-chevron-right fa-1x"></span>\t\t\t\t\t\t</td>\t\t\t\t\t</tr>'}return html+="</tbody></table>"},formatCtaDetails:function(links){var html='<table cellspacing="0" cellpadding="0" class="ib_row-details">\t\t\t\t\t\t\t<thead><tr><th class="text-left">Exists on the Following Page</th><th>&nbsp;</th></tr></thead>\t\t\t\t\t\t\t<tbody>';for(var i in links){var link=links[i];html+='<tr data-cta="'+link.cta_id+'" data-post="'+link.post_id+'">\t\t\t\t\t\t\t<td class="text-left">\t\t\t\t\t\t\t\t<a href="'+link.url+'" class="text-link">'+link.title+'</a>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t<a href="" class="ib_icon-link delete fa fa-trash ib_delete-from-post"></a>\t\t\t\t\t\t\t</td>\t\t\t\t\t\t</tr>'}return html+="</tbody></table>"},loadCtas:function(template_id){var $cta_row=$("#ctas_"+template_id),$cell=$cta_row.find("td");$cell.html(settings.spinner),$cta_row.slideDown("fast")},deleteTemplateConfirm:function($delete_button){$.confirm({title:"Delete Template?",content:"Are you sure you want to delete this template? This will also delete ALL CTA's associated with this template.",confirm:function(){window.location.href=$me.attr("href")},cancel:function(){_lockClick=!1},confirmButton:"DELETE",cancelButton:"CANCEL",confirmButtonClass:"ib_save",cancelButtonClass:"ib_cancel"})},confirmDeleteCtaFromPost:function($row){$.confirm({title:"Delete Cta from Page/Post?",content:"Are you sure you want to remove this CTA from this page/post? This DOES NOT delete the CTA or the page. Just the CTA from the page.",confirm:function(){data={nonce:ibCtaAjax.ibCtaNonce,action:"ib_delete_cta_from_post",post_id:$row.data("post"),cta_id:$row.data("cta")},$.ajax({url:ibKwAjax.ajaxurl,dataType:"json",type:"post",data:data,success:function(json,status){1==json.type?methods.deleteCTAReferenceRow($row):$.alert({title:"Error !",content:json.message,confirmButtonClass:"ib_save"})},error:function(jqXhr,textStatus,errorThrown){console.log(errorThrown)}})},cancel:function(){_lockClick=!1},confirmButton:"DELETE",cancelButton:"CANCEL",confirmButtonClass:"ib_save",cancelButtonClass:"ib_cancel"})},deleteCTAReferenceRow:function($row){$row.slideUp("slow",function(){$(this).remove()}),$details=_ibThis.find("#cta_details_"+$row.data("cta"));var $cta=$details.prev(),$pagesOn=$cta.find("#pages_on"),count=parseFloat($pagesOn.html());if(count--,count<=0){var details="<h3>This CTA has not been added to any page or post.</h3>",html='<td class="ib_cta-links" colspan="8">'+details+"</td>";$details.html(html)}$pagesOn.html(count)},confirmDeleteTemplateCta:function($row){$.confirm({title:"Delete CTA?",content:"Are you sure you want to delete this CTA. This will also remove all shortcodes in pages/posts.",confirm:function(){data={nonce:ibCtaAjax.ibCtaNonce,action:"ib_delete_template_cta",cta_id:$row.data("id")},$.ajax({url:ibKwAjax.ajaxurl,dataType:"json",type:"post",data:data,success:function(json,status){1==json.type?methods.deleteCTARow($row):$.alert({title:"Error !",content:json.message,confirmButtonClass:"ib_save"})},error:function(jqXhr,textStatus,errorThrown){console.log(errorThrown)}})},cancel:function(){_lockClick=!1},confirmButton:"DELETE",cancelButton:"CANCEL",confirmButtonClass:"ib_save",cancelButtonClass:"ib_cancel"})},deleteCTARow:function($row){$row.slideUp("slow",function(){$(this).remove()});var $details=$row.closest("tr.ib_template_details_row"),$template=$details.prev(),$ctas=$template.find("#cta_count"),count=parseFloat($ctas.html());if(count--,count<=0){var details="<h3 style='margin-left:4%'>No CTA's associated with this Template.</h3>",html='<td class="ib_template_details_row odd" colspan="6">'+details+"</td>";$details.html(html)}$ctas.html(count)}},settings=$.extend({},defaults,method);return methods[method]?(_ibThis=$(this),methods[method].apply(this,Array.prototype.slice.call(arguments,1))):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.ib_ctaLists"):this.each(function(){_ibThis=$(this),methods.init()})}}(jQuery);