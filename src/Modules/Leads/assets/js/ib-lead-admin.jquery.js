!function($){function confirmCanDeleteCustomField(delete_button){var $delete_button=$(delete_button),field_id=$delete_button.attr("data-id");$.ajax({url:ibAjax.ajaxurl,dataType:"json",type:"post",data:{action:"verify_delete_custom_lead_field",field_id:field_id},success:function(data){data.can_delete?deleteCustomLeadField(field_id):$.alert({title:"Can't Delete Custom Field",content:data.response,confirmButtonClass:"ib_save"})},error:function(jqXhr,textStatus,errorThrown){console.log(errorThrown)}})}function deleteCustomLeadField(field_id){var $row=$("#ib-customfield-row-"+field_id),label=$row.find("#ib-field-name").text();$.confirm({title:"Delete "+label,content:"Are you sure you want to delete "+label+" custom field?",confirmButtonClass:"ib_save",cancelButtonClass:"ib_cancel",confirm:function(){$.ajax({url:ibAjax.ajaxurl,dataType:"json",type:"post",data:{action:"delete_custom_lead_field",field_id:field_id},success:function(data){data.success&&$row.slideUp("slow",function(){$row.remove(),alternateListBackground('#custom-field-wrapper div[data-role="field-holder"]',"ib-white")})},error:function(jqXhr,textStatus,errorThrown){console.log(errorThrown)}})},cancel:function(){_lockClick=!1},confirmButton:"DELETE",cancelButton:"CANCEL"})}function alternateListBackground(selector,className){$(selector+":odd").each(function(){$(this).addClass(className)}),$(selector+":even").each(function(){$(this).removeClass(className)})}function editCustomLeadField(edit_link){var $edit_link=$(edit_link),field_id=$edit_link.attr("data-id"),$row=$("#ib-customfield-row-"+field_id),label=$row.find("#ib-field-name").text(),type=$row.find("#ib-field-type").text(),options=$row.find("#ib-field-options").text();$("#ib-edit-field-name").val(label),$("#ib-edit-field-type").text(type),$("#ib-edit-field-id").val(field_id);var $optionsField=$("#ib-edit-field-options");switch($optionsField.val(options),type){case"RADIO":case"CHECKBOX":case"SELECT":$optionsField.prop("required",!0),$("#ib-edit-field-options-div").show();break;default:$optionsField.prop("required",!1),$("#ib-edit-field-options-div").hide()}$editDialog.dialog("open")}function submitEditFieldForm(){$.ajax({url:ibAjax.ajaxurl,dataType:"json",type:"post",data:$editForm.serialize(),success:function(data){if(data.success){var result=data.field,$row=$("#ib-customfield-row-"+result.field_id);$row.find("#ib-field-name").html(result.field),$row.find("#ib-field-options").html(result.options.length?result.options:"&nbsp;"),$editDialog.dialog("close")}else $.alert({title:"Error!",content:data.message,confirmButtonClass:"ib_save"})},error:function(jqXhr,textStatus,errorThrown){console.log(errorThrown)}})}function getFieldRowText(data){var str='<div data-role="field-holder" class="ib-row ">\t\t<div class="ib-column ib-column-6 ib-td text-left ib-list-item">{{name}}<br>\t\t\t<a data-id="{{field_id}}" class="ib-link edit-link" href="">[edit]</a>\t\t\t<a data-id="{{field_id}}" class="ib-link delete-link red" href="">[delete]</a>\t\t</div>\t\t<div class="ib-column ib-column-3 ib-td text-center">{{type}}</div>\t\t<div class="ib-column ib-column-3 ib-td text-center">{{options}}</div>\t</div>';return str=str.replace("{{name}}",data.name).replace("{{field_id}}",data.field_id).replace("{{field_id}}",data.field_id).replace("{{type}}",data.context).replace("{{options}}",data.options)}$(document).ready(function(){$("#lead-settings-dialog").dialog({minHeigt:400,minWidth:600,autoOpen:!1}),$("#lead-management-dialog").dialog({dialogClass:"no-title",minWidth:350,autoOpen:!1,modal:!0})}),$("#add-lead-field-button").on("click",function(){$("#lead-settings-dialog").dialog("open")}),$('[data-role="lead-share"]').on("click",function(){$("#lead-management-dialog").dialog("open")});var $editDialog=$("#edit-lead-settings-dialog");$editDialog.length&&($editDialog.dialog({minHeigt:400,minWidth:600,autoOpen:!1}),$(".ib-edit-link").click(function(e){e.preventDefault(),editCustomLeadField(this)}),$editForm=$("#custom-field-edit"),$editForm.validate({submitHandler:function(form){return submitEditFieldForm(),!1}}),$("#submit-edit-button").click(function(e){e.preventDefault(),$editForm.submit()}),$(".ib-delete-link").click(function(e){e.preventDefault(),confirmCanDeleteCustomField(this)})),$('[data-role="form-type"]').on("change",function(){$.ajax({method:"POST",url:ibAjax.ajaxurl,data:{context:$('[data-role="form-type"]').val(),action:"load_custom_lead_field"},dataType:"html",success:function(data){$('[data-role="field-options-holder"]').html(data)},error:function(){$obj.contentDiv.html("Something went wrong, please try again later.")}})}),$("#lead-settings-dialog").on("click",".ib-button",function(event){var $form=$(event.target).closest("form");$.ajax({url:ibAjax.ajaxurl,dataType:"json",type:"post",data:$form.serialize(),success:function(data){var $last=$('.ib-row[data-role="field-holder"]:last'),$content=$(getFieldRowText(data));$last.hasClass("ib-white")||$content.addClass("ib-white"),$('[data-role="custom-field-wrapper"]').append($content),$("#lead-settings-dialog").dialog("close")},error:function(jqXhr,textStatus,errorThrown){console.log(errorThrown),$("#add-error").text(data.message)}})});var _ibThis,methods={init:function(){_ibThis=$(this);var $actions=_ibThis.find(".ib-pointer");$actions.each(function(){$(this).click(function(e){e.preventDefault(),methods.tabClicked($(this))})}),$actions.first().trigger("click")},tabClicked:function($tab){if($tab.hasClass("inactive")){$tab.parent().siblings().find("i").addClass("inactive"),$tab.removeClass("inactive");var i=$tab.parent().index()+1;$("#lead-share-carrot").children("div").css("visibility","hidden"),$("#lead-share-carrot div:nth-child("+i+")").css("visibility","visible")}}};$.fn.ib_leadTabs=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.ib_ctaTabs"):methods.init.apply(this,arguments)}}(jQuery);