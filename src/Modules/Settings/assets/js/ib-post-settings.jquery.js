!function($){$.fn.ib_postSettings=function(method){var _ibThis,file_frame,_aboutDescription,_aboutDescriptionCharacterUsage,defaults={data:"",clone_selector:"#ib_clone",list_selector:"",add_option_selector:"#add_option",delete_confirm_message:"Are you sure you want to delete this option?",confirm_edit_cancel:"Are you sure you want to cancel editing this option?",replace_post_settings_confirm_title:"Overwrite with defaults?",replace_post_settings_confirm_message:"Are you sure you want to replace these settings with our defaults?",save_post_settings_confirm_title:"Save as defaults?",save_post_settings_confirm_message:"Are you sure you want to save these settings as default for this network?",posting_status_error_message:"There was an error while posting this item.",posting_status_posted_message:"Item Posted.",limit_description:!1,post_link:"",network:"",network_name:"",meta_description_selector:"#MetaIbMetaDescription",default_image_message:"",default_no_image_message:"",twitter_image_limit_size:5,cant_use_about_image:!1},methods={init:function(options){_aboutDescription=_ibThis.find("#social_settings_about_description"),_ibThis.find(settings.add_option_selector).click(function(e){e.preventDefault(),methods.ib_addPostOption(null)}),_ibThis.find(settings.defaults_button).click(function(e){e.preventDefault(),methods.ib_loadPostSettingsDefault($(this))}),_ibThis.find(settings.save_as_defaults_button).click(function(e){e.preventDefault(),methods.ib_savePostSettingsAsDefault($(this))}),settings.data.length>0&&methods.ib_displayPostSettings(settings.data),_ibThis.find(".ib-about-this-page-edit").click(function(e){methods.ib_scrollToAboutThisPageBox()}),_ibThis.find('.ib-post-settings-about-page :input[type="radio"]').each(function(){var $input=$(this);$input.click(function(){methods.ib_postSettingAboutPage($(this).val())}),$input.is(":checked")&&methods.ib_postSettingAboutPage($input.val())}),_ibThis.find("#ib_set_meta_image_button").click(function(e){e.preventDefault(),methods.ib_chooseAboutPreviewImage($(this))}),_aboutDescriptionCharacterUsage=_ibThis.find("#social_settings_about_description_character_usage"),settings.limit_description&&(_aboutDescription.on("keyup",function(){methods.ib_handleCharacterLimit()}),_aboutDescription.trigger("keyup")),$metaDescription=$(settings.meta_description_selector),"twitter"!=settings.network&&"linked_in"!=settings.network||($metaDescription.on("keyup",function(){methods.ib_checkTwitterCompatibility()}),$metaDescription.trigger("keyup")),_ibThis.find("#ib_set_meta_image_button_cancel").click(function(e){e.preventDefault();var $me=$(this);$me.hide(),methods.ib_cancelImageSet($me.parent())})},ib_cancelImageSet:function($parent){var message=_ibThis.find("#ib-thumbnail-error").is(":visible")?settings.default_no_image_message:settings.default_image_message;$parent.find(".ib-meta-preview-image").html(message),$parent.find("#ib_social_about_thumbnail").val(""),$parent.find("#ib_social_about_image").val("")},ib_checkTwitterCompatibility:function(){var file_size=$("#ib_meta_image_size").val(),$meta=_ibThis.find("#data_use0"),description=$metaDescription.val()+" "+settings.post_link,validSize=methods.ib_checkTwitterImageSize(file_size),validDescription=description.length<settings.limit_description;validDescription&&validSize?($meta.attr("disabled",!1),_ibThis.find("#ib-message-error").hide(),_ibThis.find("#ib-thumbnail-error").hide()):($meta.attr("disabled",!0),$meta.is(":checked")&&_ibThis.find("#data_use1").trigger("click"),validDescription?_ibThis.find("#ib-message-error").hide():_ibThis.find("#ib-message-error").show(),validSize?_ibThis.find("#ib-thumbnail-error").hide():_ibThis.find("#ib-thumbnail-error").show());var image=_ibThis.find("#ib_social_about_image").val();if(!image.length){var message=_ibThis.find("#ib-thumbnail-error").is(":visible")?settings.default_no_image_message:settings.default_image_message;_ibThis.find("#ib-meta-preview-image").html(message)}},ib_handleCharacterLimit:function(){var val=_aboutDescription.val(),length=val.length;"twitter"==settings.network&&(length+=settings.post_link.length),length>=settings.limit_description?(_aboutDescriptionCharacterUsage.addClass("reached-limit"),length=settings.limit_description,_aboutDescription.val(val.substring(0,settings.limit_description))):_aboutDescriptionCharacterUsage.addClass("reached-limit"),_aboutDescriptionCharacterUsage.html(length+" Used.")},ib_postSettingAboutPage:function(value){var $custom=_ibThis.find(".ib-post-setting-about-custom");"custom"==value?$custom.slideDown("fast"):($custom.slideUp("fast"),methods.ib_resetCustomData())},ib_scrollToAboutThisPageBox:function(){var $box=$("#ib_about_this_page");$("html, body").animate({scrollTop:$box.offset().top},1e3,function(){$box.find("textarea").focus()})},ib_addPostOption:function(data,animate){var posting_status="",date=new Date;date.setDate(date.getDate()+1);var day=date.getDate();day<10&&(day="0"+day);var month=date.getMonth()+1,year=date.getFullYear(),when_to_post_on_option_date=month+"/"+day+"/"+year,when_to_post="on",posting_id="",when_to_post_on_option="days",when_to_post_on_option_value="1",when_to_post_time="06:00:00",accounts=[];if(data){if(posting_id=data.post_setting_id,when_to_post=data.when_to_post,when_to_post_on_option=data.when_to_post_on_option,"date"==when_to_post_on_option){when_to_post_on_option_value="";var date_arr=data.when_to_post_on_option_value.split("-");when_to_post_on_option_date=date_arr[1]+"/"+date_arr[2]+"/"+date_arr[0]}else when_to_post_on_option_value=data.when_to_post_on_option_value,when_to_post_on_option_date="";when_to_post_time=data.when_to_post_time,accounts=data.accounts,posting_status=data.posting_status}var $row=_ibThis.find(settings.clone_selector).clone();$row.find(".row-number").html(_postSettingsCounter+1),$row.find("#delete_row").click(function(e){e.preventDefault(),methods.ib_deletePostSettingsRow($(this).parent().parent())});var name_prefix="data[SocialNetworkPostSetting]["+settings.network+"]["+_postSettingsCounter+"]";$row.attr("id","settings_"+_postSettingsCounter),$row.find("#Clone0PostSettingId").attr("id","posting_id").attr("name",name_prefix+"[post_setting_id]").val(posting_id),$row.find("#Clone0IsDeleted").attr("id","is_deleted").attr("name",name_prefix+"[is_deleted]"),$row.find("#Clone0WhenToPost0").attr("id","when_to_post0").attr("name",name_prefix+"[when_to_post]").prop("checked","on"==when_to_post).click(function(){methods.ib_onPostSettingTypeClick($(this))}),$row.find("#Clone0WhenToPost1").attr("id","when_to_post1").attr("name",name_prefix+"[when_to_post]").prop("checked","now"==when_to_post).click(function(){methods.ib_onPostSettingTypeClick($(this))}),$row.find("#Clone0WhenToPostOnOption").attr("id","when_to_post_on_option").attr("name",name_prefix+"[when_to_post_on_option]").val(when_to_post_on_option).change(function(){methods.onPostOnOptionChanged($(this))}),$row.find("#Clone0WhenToPostOnOptionDate").attr("id","when_to_post_on_option_date_"+_postSettingsCounter).attr("name",name_prefix+"[when_to_post_on_option_date]").val(when_to_post_on_option_date).datepicker({dateFormat:"mm/dd/yy"}),$row.find("#Clone0WhenToPostOnOptionValue").attr("id","when_to_post_on_option_value").attr("name",name_prefix+"[when_to_post_on_option_value]").val(when_to_post_on_option_value),$row.find("#Clone0WhenToPostTime").attr("id","when_to_post_time").attr("name",name_prefix+"[when_to_post_time]").val(when_to_post_time);var $postingStatus=$row.find("#posting-status");switch($settingsDelete=$row.find("#settings-delete"),$row.addClass("ib-posting-status-"+posting_status),posting_status){case"error":case"posted":$postingStatus.addClass("ib-posting-status-"+posting_status),$postingStatus.show(),$postingStatus.find("span").html(settings["posting_status_"+posting_status+"_message"]),$settingsDelete.hide(),$row.find("input,select").each(function(){$(this).prop("disabled",!0)});break;default:$postingStatus.hide(),$settingsDelete.show()}$postingStatus.attr("href","admin.php?page=ib-admin-settings&section=ib_social_posting_records&pid="+posting_id),$row.attr("style","");var a_counter=0,a_name_prefix=name_prefix+"[accounts]";$row.find(".ib_social-accounts input").each(function(){var $input=$(this),value=parseInt($input.val());for(var i in accounts)if(value==accounts[i]){$input.prop("checked",!0);break}$input.parent();$input.attr("id","").attr("name",a_name_prefix+"["+a_counter+"]"),a_counter++}),$row.appendTo(_ibThis.find(settings.list_selector)),"on"!=when_to_post&&$row.find("#when_to_post1").trigger("click"),$row.find("#when_to_post_on_option").trigger("change"),methods.ib_updatePostSettingsAltRows(),_postSettingsCounter++,animate&&$("html, body").animate({scrollTop:$row.offset().top},2e3)},ib_onPostSettingTypeClick:function($radio){var $row=$radio.parent().parent(),$postSettings=$row.find(".post_on_settings"),$nowText=$row.find(".ib_post-now-text");"now"==$radio.val()?($postSettings.slideUp("fast"),$nowText.slideDown("fast")):($postSettings.slideDown("fast"),$nowText.slideUp("fast"))},ib_updatePostSettingsAltRows:function(){var i=0,counter=1;_ibThis.find(".ib-post-setting:visible").each(function(){var $me=$(this);i%2==0?$me.addClass("alt0"):$me.removeClass("alt0"),$me.find(".row-number").html(counter),counter++,i++})},ib_deletePostSettingsRow:function($row){$.confirm({title:"Delete Posting Setting",content:"Are you sure you want to delete these settings?",confirm:function(){$row.find("#is_deleted").val("1"),$row.fadeOut("fast",function(){methods.ib_updatePostSettingsAltRows()})},confirmButton:"DELETE",cancelButton:"CANCEL",confirmButtonClass:"ib_save",cancelButtonClass:"ib_cancel"})},onPostOnOptionChanged:function($select){var option=$select.val(),$post_settings=$select.parent().parent(),$days=$post_settings.find(".ib-number"),$date=$post_settings.find(".ib-date-picker"),$disclamer=$post_settings.parent().find("#choose-date-disclamer");switch(option){case"days":$days.show(),$date.hide(),$disclamer.hide();break;case"date":$days.hide(),$date.show(),$disclamer.show();break;default:$days.hide(),$date.hide(),$disclamer.hide()}},ib_displayPostSettings:function(data,from_defaults){_postSettingsCounter=0;var $list=_ibThis.find(settings.list_selector);from_defaults&&$list.find(".ib-post-setting:visible").each(function(){var $row=$(this);$row.find("#is_deleted").val("1"),$row.hide()});for(var i in data)from_defaults&&(data[i].post_setting_id=""),methods.ib_addPostOption(data[i],!1)},ib_loadPostSettingsDefault:function($button){_lockClick||(_lockClick=!0,$.confirm({title:settings.replace_post_settings_confirm_title,content:settings.replace_post_settings_confirm_message,confirmButtonClass:"ib_save",cancelButtonClass:"ib_cancel",confirm:function(){var post={nonce:ibKwAjax.ibKwNonce,network:$button.attr("data-network"),action:"ib_load_posting_setting_defaults"};$.ajax({url:ibKwAjax.ajaxurl,dataType:"json",type:"post",data:post,success:function(responseText,status){1==responseText.type?methods.ib_displayPostSettings(responseText.post_settings,!0):$.alert({title:"Error!",content:responseText.message,confirmButtonClass:"ib_save"}),_lockClick=!1},error:function(jqXhr,textStatus,errorThrown){console.log(errorThrown)}})},cancel:function(){_lockClick=!1}}))},ib_savePostSettingsAsDefault:function($button){_lockClick||(_lockClick=!0,$.confirm({title:settings.save_post_settings_confirm_title,content:settings.save_post_settings_confirm_message,confirmButtonClass:"ib_save",cancelButtonClass:"ib_cancel",confirm:function(){var post={nonce:ibKwAjax.ibKwNonce,network:$button.attr("data-network"),action:"ib_save_posting_setting_defaults",settings:_ibThis.find(settings.list_selector+" :input").serialize()};$.ajax({url:ibKwAjax.ajaxurl,dataType:"json",type:"post",data:post,success:function(responseText,status){1==responseText.type?$.alert({title:"Success!",content:responseText.message,confirmButtonClass:"ib_save"}):$.alert({title:"Error!",content:responseText.message,confirmButtonClass:"ib_save"}),_lockClick=!1},error:function(jqXhr,textStatus,errorThrown){$.alert({title:errorThrown}),_lockClick=!1}})},cancel:function(){_lockClick=!1}}))},ib_chooseAboutPreviewImage:function($button){file_frame?file_frame.open():(file_frame=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),button:{text:jQuery(this).data("uploader_button_text")},multiple:!1}),file_frame.on("select",function(){attachment=file_frame.state().get("selection").first().toJSON(),methods.ib_setAboutPreviewImage(attachment,$button)}),file_frame.open())},ib_setAboutPreviewImage:function(attachment,$button){"twitter"==settings.network?methods.ib_checkTwitterImageSize(attachment.filesizeInBytes)?methods.ib_handleAttachment(attachment):$.alert({title:"Image too big",content:settings.network_name+"'s image size limit is "+settings.twitter_image_limit_size+"MB. Please choose another image.",confirmButtonClass:"ib_save"}):methods.ib_handleAttachment(attachment)},ib_handleAttachment:function(attachment){var imgurl=attachment.url,thumbnail=attachment.sizes.thumbnail.url;attachment.id;_ibThis.find("#ib-meta-preview-image").html('<img src="'+thumbnail+'">'),_ibThis.find("#ib_social_about_thumbnail").val(thumbnail),_ibThis.find("#ib_social_about_image").val(imgurl),_ibThis.find("#ib_set_meta_image_button_cancel").show()},ib_checkImageForTwitter:function(attachment){methods.ib_checkTwitterCompatibility()},ib_checkTwitterImageSize:function(file_size){var one=1048576,size=file_size/one;return size<settings.twitter_image_limit_size},ib_resetCustomData:function(){_ibThis.find("#ib_social_about_thumbnail").val(""),_ibThis.find("#ib_social_about_image").val("");var message=_ibThis.find("#ib-thumbnail-error").is(":visible")?settings.default_no_image_message:settings.default_image_message;_ibThis.find("#ib-meta-preview-image").html(message),_aboutDescription.val("").trigger("keyup")}},_lockClick=!1,_postSettingsCounter=0,settings=$.extend({},defaults,method);return methods[method]?(_ibThis=$(this),methods[method].apply(this,Array.prototype.slice.call(arguments,1))):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.ib_postSettings"):this.each(function(){_ibThis=$(this),methods.init()})}}(jQuery);